# iOS Release Build Guide - Fruitify

## Prerequisites
- macOS with Xcode installed (latest stable version recommended)
- Apple Developer Account (free for testing, $99/year for App Store)
- Device/Simulator for testing

## Quick Setup

### 1. Configure Signing in Xcode

```bash
# Open the iOS project in Xcode
open ios/Runner.xcworkspace
```

In Xcode:
1. Select **Runner** in the Project Navigator
2. Select the **Runner** target
3. Go to **Signing & Capabilities** tab
4. Check **"Automatically manage signing"**
5. Select your **Team** from dropdown
6. Xcode will automatically generate a Bundle ID (e.g., `com.yourteam.fruitify`)

### 2. Build Release IPA

#### Option A: Build via Command Line (Recommended)

```bash
# Clean previous builds
flutter clean

# Get dependencies
flutter pub get

# Build iOS release (creates .app bundle)
flutter build ios --release

# The app will be at: build/ios/iphoneos/Runner.app
```

#### Option B: Build via Xcode (for App Store submission)

```bash
# Build the framework
flutter build ios --release

# Open in Xcode
open ios/Runner.xcworkspace
```

In Xcode:
1. Select **Any iOS Device (arm64)** or **Generic iOS Device** as target
2. Go to **Product** > **Archive**
3. Wait for archive to complete
4. In Organizer window:
   - Click **Distribute App**
   - Choose distribution method:
     - **App Store Connect** - for TestFlight and App Store
     - **Ad Hoc** - for specific devices (100 device limit)
     - **Development** - for development devices only

### 3. TestFlight Distribution (Easiest Wireless Testing)

1. Archive the app in Xcode (see above)
2. Choose **App Store Connect**
3. Upload to App Store Connect
4. Go to [App Store Connect](https://appstoreconnect.apple.com)
5. Navigate to **TestFlight** tab
6. Add internal/external testers
7. Testers receive email to install TestFlight app
8. They can download your app wirelessly on their devices

### 4. Direct Device Install (No Cable with Apple Configurator)

For testing without cables:
1. Install **Apple Configurator** on Mac
2. Build Ad Hoc distribution
3. Use Apple Configurator's wireless pairing feature
4. Install IPA over WiFi

## App Configuration

### Current Settings
- **App Name:** Fruitify
- **Version:** 1.0.0+1 (in `pubspec.yaml`)
- **Bundle ID:** Auto-generated by Xcode based on your Team

### Update Version for New Releases

Edit `pubspec.yaml`:
```yaml
version: 1.0.1+2  # Format: Major.Minor.Patch+BuildNumber
```

Or override during build:
```bash
flutter build ios --release --build-name=1.0.1 --build-number=2
```

## App Store Submission Checklist

- [ ] App icons configured (ios/Runner/Assets.xcassets/AppIcon.appiconset/)
- [ ] Launch screen configured
- [ ] Privacy descriptions in Info.plist (Camera, Photo Library, Face ID already added)
- [ ] Screenshots prepared (required sizes: 6.5", 5.5" displays)
- [ ] App description and metadata
- [ ] Test on physical device
- [ ] Archive and upload via Xcode
- [ ] Submit for review in App Store Connect

## Common Issues & Fixes

### "No matching provisioning profiles found"
- Enable "Automatically manage signing" in Xcode
- Or manually create provisioning profiles at [developer.apple.com](https://developer.apple.com/account/)

### Build fails with "Command PhaseScriptExecution failed"
```bash
cd ios
pod deintegrate
pod install
cd ..
flutter clean
flutter pub get
```

### "Unsupported Architecture" error
- Ensure you're building for **Any iOS Device** or **Generic iOS Device**, not Simulator

## Testing on Physical Device (Without App Store)

### Option 1: Development Build (Requires Cable First Time)
```bash
flutter build ios --release
# Open in Xcode and run on your connected device
```
After first install with cable, you can rebuild/reinstall wirelessly via Xcode.

### Option 2: Ad Hoc Distribution (Up to 100 devices)
1. Register device UDIDs at [developer.apple.com](https://developer.apple.com/account/resources/devices/list)
2. Create Ad Hoc provisioning profile
3. Archive and export Ad Hoc .ipa
4. Install via Apple Configurator or TestFlight

### Option 3: TestFlight (Recommended - No Cable Required)
- Upload to TestFlight (see above)
- Invite testers by email
- They install via TestFlight app
- Supports 10,000 external testers

## Backend Considerations

Your app connects to Laravel backend at `http://127.0.0.1:8081/api`

For production iOS release:
1. Deploy backend to production server (e.g., DigitalOcean, AWS, Heroku)
2. Update `lib/config/env.dart` with production URL:
   ```dart
   static const String apiBaseUrl = 'https://your-domain.com/api';
   ```
3. Rebuild iOS app with production backend URL

## Quick Commands Reference

```bash
# Clean build
flutter clean && flutter pub get

# Build release for iOS
flutter build ios --release

# Build with custom version
flutter build ios --release --build-name=1.0.1 --build-number=2

# Run on connected iOS device (debug)
flutter run -d ios

# Open iOS project in Xcode
open ios/Runner.xcworkspace

# Check for iOS build issues
flutter doctor -v
```

## Resources

- [Apple Developer Portal](https://developer.apple.com)
- [App Store Connect](https://appstoreconnect.apple.com)
- [Flutter iOS Deployment Guide](https://docs.flutter.dev/deployment/ios)
- [TestFlight Documentation](https://developer.apple.com/testflight/)

---

**Next Steps:**
1. Open Xcode and configure signing with your Apple Developer account
2. Build and test on a physical device
3. Archive and upload to TestFlight for wireless distribution
4. Share TestFlight invite links with testers
